# コーディング規約 クイックリファレンス

## 🚨 最重要ルール（必須遵守）

### アーキテクチャパターン
- **iOS**: View → ViewModel(@MainActor) → Service(Actor) → Model(SwiftData)
- **Backend**: Controller → Service → Repository → Entity(Prisma)
- **禁止**: レイヤー跨ぎの直接アクセス、循環依存

### ハードコーディング禁止
- **絶対禁止**: 設定値、URL、APIキー、パスワードの直接記述
- **必須**: 全ての設定値は環境変数で管理

## 📋 命名規則
- **ファイル**: kebab-case (`chat-service.ts`)
- **クラス**: PascalCase (`ChatService`)
- **関数**: camelCase (`sendMessage`)
- **定数**: SCREAMING_SNAKE_CASE (`MAX_MESSAGE_LENGTH`)

## 🔧 技術固有ルール

### Swift 6.1
- **必須**: `@MainActor`でUI更新保証
- **Actor分離**: 共有状態はActorで管理
- **禁止**: UIKit混在、強制アンラップ(`!`)

### TypeScript (Nest.js)
- **必須**: DTO使用、依存性注入
- **禁止**: `any`型、直接DB操作

## 🛡️ セキュリティ
- **必須**: JWT検証、入力検証、ファイル制限
- **環境変数**: 機密情報は環境変数のみ

## ⚡ パフォーマンス
- **DB**: N+1問題回避、インデックス設定
- **メモリ**: 画像リサイズ、キャッシュ活用

## 🧪 テスト（必須）
- **実装ルール**: 一機能実装したら必ず単体テストを作成・実行
- **カバレッジ**: 最低80%
- **モック**: 外部依存はモック使用
- **実行タイミング**: 機能実装完了後、即座にテスト作成・実行

## 📝 Git
- **コミット**: `type(scope): description`
- **ブランチ**: `feature/description` または `fix/description`

## 🤖 AI開発時のチェックリスト
1. レイヤー分離されているか？
2. 依存関係は正しいか？
3. ハードコーディングはないか？
4. 環境変数で管理されているか？
5. セキュリティ要件を満たしているか？
6. 機能実装後に単体テストを作成・実行したか？

---
*詳細は `コーディング規約.md` を参照*
